# BORG

Bounded Outcome Risk Guard

BORG detects invalid model evaluation. It identifies when information
flows from test data into training, and blocks the evaluation before
misleading metrics are produced.

## Why BORG?

You won’t know your evaluation is broken. The code runs fine, metrics
look good, you publish or deploy. Months later you find out your 94%
accuracy is 70% on real data.

A [Princeton meta-analysis](https://reproducible.cs.princeton.edu/)
found leakage errors in **648 published papers across 30 scientific
fields**. In civil war prediction research, correcting leakage revealed
that “complex ML models do not perform substantively better than
decades-old Logistic Regression.” The reported gains were artifacts.

BORG catches these errors before you compute metrics. It refuses to
proceed when evaluation is invalid.

## Installation

``` r

# install.packages("remotes")
remotes::install_github("gcol33/BORG")
```

## The Problem

``` r

# This code produces inflated performance estimates
data <- read.csv("data.csv")
data_scaled <- scale(data[, -1])
train <- data_scaled[1:800, ]
test <- data_scaled[801:1000, ]
model <- lm(y ~ ., data = train)
rmse <- sqrt(mean((test$y - predict(model, test))^2))
```

The call to [`scale()`](https://rdrr.io/r/base/scale.html) computed mean
and standard deviation using all 1000 rows. This leaks test set
information into training. The reported RMSE won’t match real-world
performance.

## The Solution

``` r

library(BORG)

# One function does it all
borg(data, train_idx = 1:800, test_idx = 801:1000)
# Error: BORG HARD VIOLATION: preprocessing fitted on full data
```

BORG fails closed. No metrics get computed.

## Usage

``` r

# Validate a train/test split
borg(data, train_idx = 1:800, test_idx = 801:1000)

# Check for target leakage
borg(data, train_idx, test_idx, target_col = "outcome")

# Check a preprocessing object
borg(my_recipe, train_idx, test_idx, data = data)

# Check a fitted model
borg(my_model, train_idx, test_idx, data = data)

# Validate grouped data (e.g., patients)
borg(data, train_idx, test_idx, group_col = "patient_id")

# Validate temporal split
borg(data, train_idx, test_idx, temporal_col = "date")

# Validate spatial separation
borg(geo_data, train_idx, test_idx, spatial_cols = c("lon", "lat"))
```

## Functions

| Function | Purpose |
|----|----|
| [`borg()`](https://gillescolling.com/BORG/reference/borg.md) | Validate any object against a train/test split |
| [`borg_inspect()`](https://gillescolling.com/BORG/reference/borg_inspect.md) | Detailed object inspection |
| [`borg_validate()`](https://gillescolling.com/BORG/reference/borg_validate.md) | Validate complete workflow |
| [`borg_rewrite()`](https://gillescolling.com/BORG/reference/borg_rewrite.md) | Attempt automatic repair |

## What BORG Detects

**Hard Violations** (blocks evaluation):

- Train-test index overlap
- Duplicate rows between train and test
- Preprocessing fitted on full data (preProcess, recipe, prcomp)
- PCA loadings computed on full data
- CV folds containing test indices
- Model trained on wrong data scope
- Target leakage (\|correlation\| \> 0.99 with target)
- Group membership in both splits
- Temporal ordering violated (test predates training)

**Soft Warnings** (flags but continues):

- Proxy leakage (correlation 0.95-0.99 with target)
- Spatial proximity (test points close to training)
- Spatial overlap (test inside training convex hull)

## Design Principles

1.  BORG is a gate, not a linter
2.  Fail closed on ambiguity
3.  No metrics computed from invalid evaluations
4.  Risk defined at outcome validity, not technique correctness

## Documentation

- [Quick Start](https://gillescolling.com/BORG/articles/quickstart.html)
- [Risk
  Taxonomy](https://gillescolling.com/BORG/articles/risk-taxonomy.html)
- [Framework
  Integration](https://gillescolling.com/BORG/articles/frameworks.html)
- [Enforcement Surface
  Specification](https://gillescolling.com/BORG/ENFORCEMENT_SURFACE.html)

## License

MIT

# Package index

## Main Entry Point

Start here

- [`borg()`](https://gillescolling.com/BORG/reference/borg.md) : BORG:
  Guard Your Model Evaluation

## Core Functions

Detailed validation functions

- [`borg_inspect()`](https://gillescolling.com/BORG/reference/borg_inspect.md)
  : Inspect R Objects for Evaluation Risks
- [`borg_validate()`](https://gillescolling.com/BORG/reference/borg_validate.md)
  : Validate Complete Evaluation Workflow

## Remediation

Automatic pipeline correction

- [`borg_rewrite()`](https://gillescolling.com/BORG/reference/borg_rewrite.md)
  : Automatically Rewrite Leaky Evaluation Pipelines

## Visualization

Plot functions for split analysis

- [`plot_split()`](https://gillescolling.com/BORG/reference/plot_split.md)
  : Plot Train/Test Split Distribution
- [`plot_risk()`](https://gillescolling.com/BORG/reference/plot_risk.md)
  : Plot Risk Assessment Summary
- [`plot_temporal()`](https://gillescolling.com/BORG/reference/plot_temporal.md)
  : Plot Temporal Validation
- [`plot_spatial()`](https://gillescolling.com/BORG/reference/plot_spatial.md)
  : Plot Spatial Split
- [`plot_groups()`](https://gillescolling.com/BORG/reference/plot_groups.md)
  : Plot Group-Based Split

## Audit Functions

Prediction and CV auditing

- [`audit_predictions()`](https://gillescolling.com/BORG/reference/audit_predictions.md)
  : Audit Predictions for Data Leakage
- [`audit_importance()`](https://gillescolling.com/BORG/reference/audit_importance.md)
  : Audit Feature Importance Calculations
- [`cv_leakage_report()`](https://gillescolling.com/BORG/reference/cv_leakage_report.md)
  : Generate CV Leakage Report
- [`borg_cv()`](https://gillescolling.com/BORG/reference/borg_cv.md) :
  Generate Valid Cross-Validation Scheme
- [`borg_diagnose()`](https://gillescolling.com/BORG/reference/borg_diagnose.md)
  : Diagnose Data Dependency Structure
- [`show(`*`<BorgDiagnosis>`*`)`](https://gillescolling.com/BORG/reference/BorgDiagnosis.md)
  : BorgDiagnosis S4 Class

## Configuration

Options and settings

- [`borg_auto_check()`](https://gillescolling.com/BORG/reference/borg_auto_check.md)
  : Enable/Disable BORG Auto-Check Mode
- [`borg_options()`](https://gillescolling.com/BORG/reference/borg_options.md)
  : Get Current BORG Options

## Classes

Result objects

- [`show(`*`<BorgRisk>`*`)`](https://gillescolling.com/BORG/reference/BorgRisk.md)
  : BorgRisk S4 Class
- [`as.data.frame(`*`<BorgRisk>`*`)`](https://gillescolling.com/BORG/reference/as.data.frame.BorgRisk.md)
  : Coerce BorgRisk to Data Frame
- [`print(`*`<borg_cv_report>`*`)`](https://gillescolling.com/BORG/reference/print.borg_cv_report.md)
  : Print CV Leakage Report

# Articles

### Getting Started

- [Quick Start](https://gillescolling.com/BORG/articles/quickstart.md):

### Deep Dives

- [Risk
  Taxonomy](https://gillescolling.com/BORG/articles/risk-taxonomy.md):
- [Framework
  Integration](https://gillescolling.com/BORG/articles/frameworks.md):
