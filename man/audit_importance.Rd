% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/borg_audit.R
\name{audit_importance}
\alias{audit_importance}
\title{Audit Feature Importance Calculations}
\usage{
audit_importance(
  importance,
  data,
  train_idx,
  test_idx,
  method = "auto",
  model = NULL
)
}
\arguments{
\item{importance}{A vector, matrix, or data frame of importance values.}

\item{data}{The data used to compute importance.}

\item{train_idx}{Integer vector of training indices.}

\item{test_idx}{Integer vector of test indices.}

\item{method}{Character indicating the importance method. One of
"shap", "permutation", "gain", "impurity", or "auto" (default).}

\item{model}{Optional fitted model object for additional validation.}
}
\value{
A BorgRisk object with audit results.
}
\description{
Detects when feature importance (SHAP, permutation importance, etc.) is
computed using test data, which can lead to biased feature selection and
data leakage.
}
\details{
Feature importance computed on test data is a form of data leakage because:
\itemize{
\item SHAP values computed on test data reveal test set structure
\item Permutation importance on test data uses test labels
\item Feature selection based on test importance leads to overfit models
}

This function checks if the data used for importance calculation includes
test indices and flags potential violations.
}
\examples{
set.seed(42)
data <- data.frame(y = rnorm(100), x1 = rnorm(100), x2 = rnorm(100))
train_idx <- 1:70
test_idx <- 71:100

# Simulate importance values
importance <- c(x1 = 0.6, x2 = 0.4)

# Good: importance computed on training data
result <- audit_importance(importance, data[train_idx, ], train_idx, test_idx)

# Bad: importance computed on full data (includes test)
result_bad <- audit_importance(importance, data, train_idx, test_idx)

}
