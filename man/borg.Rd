% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/borg.R
\name{borg}
\alias{borg}
\title{BORG: Guard Your Model Evaluation}
\usage{
borg(
  data,
  coords = NULL,
  time = NULL,
  groups = NULL,
  target = NULL,
  v = 5,
  train_idx = NULL,
  test_idx = NULL,
  output = c("list", "rsample", "caret", "mlr3"),
  ...
)
}
\arguments{
\item{data}{A data frame to diagnose and create CV folds for.}

\item{coords}{Character vector of length 2 specifying coordinate column names
(e.g., \code{c("lon", "lat")}). Triggers spatial autocorrelation detection.}

\item{time}{Character string specifying the time column name. Triggers
temporal autocorrelation detection.}

\item{groups}{Character string specifying the grouping column name
(e.g., "site_id", "patient_id"). Triggers clustered structure detection.}

\item{target}{Character string specifying the response variable column name.
Used for more accurate autocorrelation diagnostics.}

\item{v}{Integer. Number of CV folds. Default: 5.}

\item{train_idx}{Integer vector of training indices. If provided along with
\code{test_idx}, validates an existing split instead of generating one.}

\item{test_idx}{Integer vector of test indices. Required if \code{train_idx}
is provided.}

\item{output}{Character. CV output format: "list" (default), "rsample",
"caret", "mlr3". Ignored when validating an existing split.}

\item{...}{Additional arguments passed to underlying functions.}
}
\value{
Depends on usage mode:

\strong{Diagnosis mode} (no train_idx/test_idx): A list with class "borg_result"
containing:
\describe{
\item{diagnosis}{A \code{\link{BorgDiagnosis}} object with dependency analysis}
\item{cv}{A \code{borg_cv} object with valid cross-validation folds}
\item{folds}{Shortcut to \code{cv$folds} for convenience}
}

\strong{Validation mode} (with train_idx/test_idx): A \code{\link{BorgRisk}}
object containing the risk assessment of the provided split.
}
\description{
The main entry point for BORG. Diagnoses data dependencies, generates
valid cross-validation schemes, and validates evaluation workflows.
}
\details{
\code{borg()} operates in two modes:

\subsection{Diagnosis Mode (Recommended)}{
When called with structure hints (\code{coords}, \code{time}, \code{groups})
but without \code{train_idx}/\code{test_idx}, BORG:
\enumerate{
\item Diagnoses data dependencies (spatial, temporal, clustered)
\item Estimates how much random CV would inflate metrics
\item Generates appropriate CV folds that respect the dependency structure
\item Returns everything needed to proceed with valid evaluation
}

This is the recommended workflow. Let BORG tell you how to split your data.
}

\subsection{Validation Mode}{
When called with \code{train_idx} and \code{test_idx}, BORG validates the
existing split:
\itemize{
\item Checks for index overlap
\item Validates group isolation (if \code{groups} specified)
\item Validates temporal ordering (if \code{time} specified)
\item Checks spatial separation (if \code{coords} specified)
\item Detects preprocessing leakage, target leakage, etc.
}

Use this mode to verify splits you've created yourself.
}
}
\examples{
# ===== DIAGNOSIS MODE (recommended) =====

# Spatial data: let BORG create valid folds
set.seed(42)
spatial_data <- data.frame(
  x = runif(200, 0, 100),
  y = runif(200, 0, 100),
  response = rnorm(200)
)

result <- borg(spatial_data, coords = c("x", "y"), target = "response")
result$diagnosis
result$folds[[1]]  # First fold's train/test indices

# Clustered data
clustered_data <- data.frame(
  site = rep(1:20, each = 10),
  value = rep(rnorm(20), each = 10) + rnorm(200, sd = 0.5)
)

result <- borg(clustered_data, groups = "site", target = "value")
result$diagnosis@recommended_cv  # "group_fold"

# Temporal data
temporal_data <- data.frame(
  date = seq(as.Date("2020-01-01"), by = "day", length.out = 200),
  value = cumsum(rnorm(200))
)

result <- borg(temporal_data, time = "date", target = "value")

\dontrun{
# Get rsample-compatible output for tidymodels (requires rsample package)
result <- borg(spatial_data, coords = c("x", "y"), output = "rsample")
}

# ===== VALIDATION MODE =====

# Validate an existing split
data <- data.frame(x = 1:100, y = rnorm(100))
borg(data, train_idx = 1:70, test_idx = 71:100)

# Validate with group constraint
data$patient <- rep(1:10, each = 10)
borg(data, train_idx = 1:50, test_idx = 51:100, groups = "patient")

}
\seealso{
\code{\link{borg_diagnose}} for diagnosis only,
\code{\link{borg_cv}} for CV generation only,
\code{\link{borg_inspect}} for detailed object inspection.
}
