% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/borg_rewrite.R
\name{borg_rewrite}
\alias{borg_rewrite}
\title{Automatically Rewrite Leaky Evaluation Pipelines}
\usage{
borg_rewrite(workflow, risks = NULL, fix = "all")
}
\arguments{
\item{workflow}{A list containing the evaluation workflow (same structure
as \code{\link{borg_validate}}).}

\item{risks}{Optional \code{\link{BorgRisk}} object from a previous
inspection. If NULL, \code{borg_validate()} is called first.}

\item{fix}{Character vector specifying which risk types to attempt to fix.
Default: \code{"all"} attempts all rewritable violations.
Other options: \code{"preprocessing"}, \code{"feature_engineering"},
\code{"thresholds"}.}
}
\value{
A list containing:
\describe{
\item{workflow}{The rewritten workflow (modified in place where possible)}
\item{fixed}{Character vector of risk types that were successfully fixed}
\item{unfixable}{Character vector of risk types that could not be fixed}
\item{report}{\code{BorgRisk} object from post-rewrite validation}
}
}
\description{
\code{borg_rewrite()} attempts to automatically fix detected evaluation risks
by restructuring the pipeline to avoid information leakage.
}
\details{
\code{borg_rewrite()} can automatically fix certain types of leakage:

\describe{
\item{Preprocessing on full data}{Refits preprocessing objects using
only training indices}
\item{Feature engineering leaks}{Recomputes target encodings, embeddings,
and derived features using train-only data}
\item{Threshold optimization}{Moves threshold selection to training/validation
data}
}

Some violations cannot be automatically fixed:
\itemize{
\item Train-test index overlap (requires new split)
\item Target leakage in original features (requires domain intervention)
\item Temporal look-ahead in features (requires feature re-engineering)
}
}
\examples{
\dontrun{
# Attempt to fix a leaky workflow
result <- borg_rewrite(my_workflow)

if (length(result$unfixable) > 0) {
  warning("Some risks could not be automatically fixed")
  print(result$unfixable)
}

# Use the fixed workflow
fixed_workflow <- result$workflow
}

}
\seealso{
\code{\link{borg_validate}} for validation without rewriting,
\code{\link{borg}} for proactive enforcement.
}
